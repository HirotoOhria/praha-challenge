# 課題1

### 前提知識

- [Check](https://dev.mysql.com/doc/refman/8.0/ja/create-table-check-constraints.html)
  - 制約条件を指定し、条件が FALSE になると制約違反が発生する
    - age INT CHECK age > 10
    - status VARCHAR status IN ("normal", "reject", "disable")
  - 制約にはテーブル制約とカラム制約の2種類がある
- [Enum](https://dev.mysql.com/doc/refman/5.6/ja/enum.html)
  - 列挙された値のいずれかを取る文字列オブジェクト
    - size ENUM('x-small', 'small', 'medium', 'large', 'x-large')
- [Domain](https://www.postgresql.jp/docs/9.2/sql-createdomain.html)
  - 特別な制約を持ったデータ型
  - 共通の制約を1箇所にまとめて定義できる
    - メールアドレスの構文を検証する CHECK 制約、など
  - [MySQL ではサポートされていない](https://stackoverflow.com/questions/1693991/create-domain-in-mysql)
- [Trigger]
  - 特定のテーブル操作 (INSERT, UPDATE, DELETE) を起点に、処理を自動実行する機能


### 回答

- メールアドレスのカラムには特定ドメインしか登録できない。 Check 制約を使用するべきか？
  - 結論
    - するべきでない
  - メリット
    - 値の整合性を DB 制約レベルで担保できる
  - デメリット
    - ビジネスロジックの分散
      - ロジックがアプリケーションとDBの2箇所に存在する
      - ビジネスロジック全体の理解が困難になる
      - ロジックが変更された場合の変更箇所が増える
- ユーザーの退会時にあるテーブルから削除し、別のテーブルへ追加しなければならない。Trigger 制約を使用するべきか？
  - 結論
    - するべきでない
  - メリット
    - 値の整合性を DB 制約レベルで担保できる
  - デメリット
    - ビジネスロジックの分散
      - ロジックがアプリケーションとDBの2箇所に存在する
      - ビジネスロジック全体の理解が困難になる
      - ロジックが変更された場合の変更箇所が増える
- 性別カラムには特定の値しか入らない。Enum 型を使用するべきか？
  - 結論
    - するべきでない
  - メリット
    - 値の整合性を DB 制約レベルで担保できる
  - デメリット
    - 値のリストを取得できない
    - 型情報を見る必要がある
    - 値を追加/削除するコストが大きい
      - 追加: 型定義の変更が必要
      - 削除: 型定義の変更 & レコード更新が必要
- 郵便番号カラムには特定形式の文字列しか入れてはいけない。Domainを使用するべきか？
  - 結論
    - するべきでない
  - メリット
    - 値の整合性を DB 制約レベルで担保できる
  - デメリット
    - ビジネスロジックの分散
      - ロジックがアプリケーションとDBの2箇所に存在する
      - ビジネスロジック全体の理解が困難になる
      - ロジックが変更された場合の変更箇所が増える
- 制約をアプリケーション側で課すアプローチと、データベース側で制約を課すアプローチがある。どちらをどのような時に採用するべきか？
  - アプリケーション側で課すアプローチ
    - 基本的にはこっちを採用
  - データベース側で課すアプローチ
    - ロジックが分散するので基本的にすべきではない
    - Trigger は条件によってはありかも
      - ユーザー退会によるレコード削除と履歴レコードの追加の整合性の要求レベルが高い
        - Trigger 制約で行うことにより、サーバーとDBの通信回数を減らす(通信エラーのリスク低下)

# 課題2

- SNS サイト
  - ユーザーの履歴を残す必要がある (Trigger制約)
  - ユーザーの状態を表現する (Check制約)







