# 課題1
### 回答

![sushi_order](https://user-images.githubusercontent.com/60952535/184474429-0a131b64-7b12-4540-bb5f-c574e26666a3.png)

### テーブルと現実の対応関係の解説

- お好み寿司商品
  - メニュー
    - 「えび」
  - 商品
    - 「えび」2個
- 丼商品
  - メニュー
    - 「鉄火丼」
  - 商品
    - 「鉄火丼」1個
- 盛り込み商品
  - メニュー
    - 「はな」
  - 商品
    - 「えび」2個
    - 「サーモン」2個
    - 「玉子」1個
    - 「かっぱ巻」4個

### 考えたこと

- 日時のデータ型を datetime にするか timestamp にするか
  - 結論
    - datetime にする
  - 理由
    - timestamp の 2038年問題を回避するため
    - [それぞれのデータ型の違い](https://qiita.com/ykawakami/items/2449a24e3b82ff0cbab6)
      - datetime
        - 1000年 ~ 9999年 まで対応
        - 月や日付の値に `00` を許容する
      - timestamp
        - 1970年 ~ 2038年 まで対応
        - 月や日付の値に `00` を許容しない
- 寿司の内容を「寿司一貫」まで表現するか
  - 結論
    - する
      - 寿司販売という業務において、寿司一貫単位を扱いたい場合が出てくると考えたため
  - 理由
    - 表現する場合
      - メリット
        - 寿司一貫単位ので分析が可能になる
      - デメリット
        - 情報量が増え、システムの複雑さが増す
    - 表現しない場合
      - メリット
        - システムがシンプルになる
      - デメリット
        - 寿司一貫単位で文政期したいニーズが発生した場合、システムが正規化されず複雑になる
- カテゴリーテーブルを用意するか
  - 結論
    - する
  - 理由
    - 業務的にカテゴリーごとに分けて集計したいニーズが有ると考えたため
- 税込かの情報を保持する必要はあるか
  - 結論
    - ある
  - 理由
    - 価格が税抜きか税込みかが明示的になるため
    - 将来的な計算方法の変更に対応するため
      - 寿司の価格カラムの値を税込で統一した場合
        - 解説
          - 消費税率が変更された場合に価格がずれる可能性がある
          - 税込かの情報がないと、現在ある税込価格から逆算して元の価格を計算する必要がある
        - 消費税10%
          - 現実世界の税抜の寿司の価格: 95円
          - DBに登録する寿司の価格: 105円 (95 * 1.10 = 104.5円を四捨五入)
        - 消費税12%に変更
          - 現実世界の税抜の寿司の価格: 95円
          - DBに登録する寿司の価格: 107円 ((105 / 1.10) * 1.12 = 106.9円を四捨五入)
          - 本来登録すべきDBの寿司の価格: 106円 (95 * 1.12 = 106.4円を四捨五入)
      - 価格を小数点以下まで保存するにする方法もある
        - 現実世界では価格が小数点以下まで存在することはなく、扱いが難しい
- さび抜きかどうかの情報を中間テーブルではなく独立テーブルに分けたほうが良いか
  - 結論
    - 分ける
      - かなり迷う部分ではある
        - 理想を追うのか(責務の明確化)、現実を追うのか(冗長性の解消)
      - 注文の寿司ごとのオプションが増える可能性を考え、今回は分ける
  - 理由
    - 以下のどちらも考え方としてアリと感じる
      - オプション情報が2個以上になると分けたほうが良いと感じる
    - 分けない
      - 中間テーブルの責務が多い (関係性の表現 + オプション情報の文字)
      - JOIN コストの低下
    - 分ける
      - テーブルの責務が明確 (中間テーブル: 関係性の表現, オプションテーブル: さび抜きかの保持)
      - JOIN コストの増加


# 課題2

### 仕様の確認
- 知りたいのは「セット商品内の寿司ネタも含めた販売個数」で間違いないか
  - つまり「セット商品+個別」で売れた寿司ネタの個数を知りたい

### 回答
- さびの大小を選べるようにする
  - 注文と寿司の中間テーブルに「シャリの大きさ(int)」カラムを追加する
    - 将来的な拡張性を持たせるため、「シャリは小か(boolean)」カラムではなくする(もしかしたら中も選べるようにしたいかも)
- 寿司ネタが毎月何個売れているかを知りたい
  - 「セットメニューと寿司」を「1:N」で関連させる中間テーブルを追加する

# 課題3

### 回答
- 税込価格で表示したい
  - 税込みかのカラムを保持しているため、アプリケーション側で対応可能
- 税込価格の計算方法を変えたい (端数の切り捨てではなく、端数の切り上げで計算したい)
  - 税込みかのカラムを保持しているため、アプリケーション側で対応可能
- セットメニュー内でも個別の寿司ごとにさび抜きかどうかを選択したい
  - この仕様変更やばい、、、
  - 「注文とセットメニューと寿司」を「1:N:N」で関連させる中間テーブルの追加

# 任意課題

### 回答
- 物理モデルと論理モデルの違い
  - 論理モデルは概念上のモデル
  - 物理モデルは実際のデータベースに対応したモデル
- 論理モデル
  - 実態と関連の決定
    - テーブルの決定、関係性の決定
    - テーブルの正規化
    - カラムのデータ型の決定
- 物理モデル
  - データベースの性能を考慮して設計
    - 性能に最適化させてテーブル定義を崩す
    - インデックスの定義
    - データベースに依存する機能の利用


### 参考文献
- [第1回 データベース設計とは | gihyo.jp](https://gihyo.jp/dev/feature/01/database/0001)
