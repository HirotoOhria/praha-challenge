# 課題1
### 回答

![sushi_order_of_task1](https://user-images.githubusercontent.com/60952535/185267113-db283b83-cf9d-4a64-bfcd-b19b621bf888.png)

### テーブルと現実の対応関係の解説

- お好み寿司商品
  - メニュー
    - 「えび」
  - 商品
    - 「えび」2貫
- 丼商品
  - メニュー
    - 「鉄火丼」
  - 商品
    - 「鉄火丼」1個
- 盛り込み商品
  - メニュー
    - 「はな」
  - 商品
    - 「えび」2貫
    - 「サーモン」2貫
    - 「玉子」1個
    - 「かっぱ巻」4本

### 考えたこと

- 日時のデータ型を datetime にするか timestamp にするか
  - 結論
    - datetime にする
  - 理由
    - timestamp の 2038年問題を回避するため
    - [それぞれのデータ型の違い](https://qiita.com/ykawakami/items/2449a24e3b82ff0cbab6)
      - datetime
        - 1000年 ~ 9999年 まで対応
        - 月や日付の値に `00` を許容する
      - timestamp
        - 1970年 ~ 2038年 まで対応
        - 月や日付の値に `00` を許容しない
- 寿司の内容を「寿司一貫」まで表現するか
  - 結論
    - する
      - 寿司販売という業務において、寿司一貫単位を扱いたい場合が出てくると考えたため
  - 理由
    - 表現する場合
      - メリット
        - 寿司一貫単位ので分析が可能になる
      - デメリット
        - 情報量が増え、システムの複雑さが増す
    - 表現しない場合
      - メリット
        - システムがシンプルになる
      - デメリット
        - 寿司一貫単位で文政期したいニーズが発生した場合、システムが正規化されず複雑になる
- カテゴリーテーブルを用意するか
  - 結論
    - する
  - 理由
    - 業務的にカテゴリーごとに分けて集計したいニーズが有ると考えたため
- 商品の価格が税込かのカラムを保持するか
  - 結論
    - しない
  - 理由
    - 税込みかの計算はアプリケーション側で対応できると考えたため
    - 商品ごとに税込/税抜が異なるなら保持するが、今回は異なるわけではない
- 「さび抜きか」などの注文オプションの情報を中間テーブルではなく独立テーブルに分けたほうが良いか
  - 結論
    - 分ける
      - かなり迷う部分ではある
        - 理想を追うのか(責務の明確化)、現実を追うのか(冗長性の解消)
      - 注文の寿司ごとのオプションが増える可能性を考え、今回は分ける
  - 理由
    - 以下のどちらも考え方としてアリと感じる
      - オプション情報が2個以上になると分けたほうが良いと感じる
    - 分けない
      - 中間テーブルの責務が多い (関係性の表現 + オプション情報の文字)
      - JOIN コストの低下
    - 分ける
      - テーブルの責務が明確 (中間テーブル: 関係性の表現, オプションテーブル: さび抜きかの保持)
      - JOIN コストの増加
- 注文テーブルにメニュー個数カラムを用意するか
  - 結論
    - する
  - 理由
    - ビジネス的に商品単価(今回のテーブル構成ではメニュー単価)を算出するニーズがあると考えたため
    - 関連するうメニューテーブルの個数をカウントしてもよいが、参照コストを小さくするために集計結果を保存する

# 課題2

### 仕様の確認
- 知りたいのは「セット商品内の寿司ネタも含めた販売個数」で間違いないか
  - つまり「セット商品+個別」で売れた寿司ネタの個数を知りたい

### 回答
- さびの大小を選べるようにする
  - 注文と寿司の中間テーブルに「シャリの大きさ(int)」カラムを追加する
    - 将来的な拡張性を持たせるため、「シャリは小か(boolean)」カラムではなくする(もしかしたら中も選べるようにしたいかも)
    - 「シャリの大きさ(int)」の具体的な値は Enum となる
      - 1: 小
      - 2: 大
- 寿司ネタが毎月何個売れているかを知りたい
  - テーブル構成の変更はなし
  - 注文 ~ 商品テーブルまでを結合し、月ごとの注文から売れた商品の数を集計する

# 課題3

### 回答
- 税込価格で表示したい
  - テーブル構成の変更はなし
  - アプリケーション側の計算方法を変更する形で対応
- セットメニュー内でも個別の寿司ごとにさび抜きかどうかを選択したい
  - この仕様変更やばい、、、
  - 注文オプションを商品ごとに保持する (order_product_options)

![sushi_order_of_task3](https://user-images.githubusercontent.com/60952535/185267123-f5452534-0b02-48ca-98a4-530744e7e0f9.png)

# 任意課題

### 回答
- 物理モデルと論理モデルの違い
  - 論理モデルは概念上のモデル
  - 物理モデルは実際のデータベースに対応したモデル
- 論理モデル
  - 実態と関連の決定
    - テーブルの決定、関係性の決定
    - テーブルの正規化
    - カラムのデータ型の決定
- 物理モデル
  - データベースの性能を考慮して設計
    - 性能に最適化させてテーブル定義を崩す
    - インデックスの定義
    - データベースに依存する機能の利用


### 参考文献
- [第1回 データベース設計とは | gihyo.jp](https://gihyo.jp/dev/feature/01/database/0001)
